<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat de Observaciones - InundApp Villa Elvira</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="estilos.css">
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background-color: white;
      font-family: monospace;
      color: black;
    }

    .app {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .app-header {
      background-color: #788CFF;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .app-header h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    .btn-modo-claro {
      background-color: #ffffff;
      color: #333;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .btn-modo-claro:hover,
    .btn-modo-claro:focus {
      background-color: #e0e0e0;
      transform: scale(1.05);
      outline: none;
    }

    .btn-modo-claro:focus {
      box-shadow: 0 0 0 3px #788CFF;
    }

    .app-body {
      flex: 1;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .app-body h1 {
      color: #788CFF;
      font-size: 1.8rem;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 1rem;
    }

    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
    }

    .chat-mensajes {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background-color: #f9f9f9;
      border-bottom: 1px solid #ccc;
    }

    .mensaje {
      padding: 0.5rem 0;
      border-bottom: 1px solid #ddd;
    }

    .mensaje strong {
      color: #33691e;
    }

    .chat-formulario {
      display: flex;
      gap: 10px;
      padding: 1rem;
      background-color: #fff;
    }

    .chat-formulario input[type="text"] {
      flex: 1;
      border-radius: 8px;
      border: 1px solid #ccc;
      padding: 10px;
      font-size: 1rem;
    }

    .chat-formulario button {
      border-radius: 12px;
      padding: 10px 16px;
      background-color: #43a047;
      border: none;
      color: white;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
    }

    .chat-formulario button:hover {
      background-color: #388e3c;
    }

    .btn-volver {
      background-color: #c62828;
      color: white;
      border-radius: 8px;
      padding: 10px 16px;
      font-weight: bold;
      font-size: 1rem;
      text-decoration: none;
      width: fit-content;
      transition: background-color 0.3s ease;
      border: none;
      margin-top: 1rem;
    }

    .btn-volver:hover,
    .btn-volver:focus {
      background-color: #a22323;
      outline: none;
    }
  </style>
</head>
<body aria-label="P√°gina de chat de observaciones de zonas de riesgo">

  <div class="app" role="main" aria-label="Aplicaci√≥n para registrar observaciones en zonas inundables">
    <header class="app-header" role="banner" aria-label="Encabezado con controles de accesibilidad">
      <h1 id="titulo-app">InundApp Villa Elvira</h1>
      <div class="d-flex gap-2">
        <button id="modo-btn" class="btn-modo-claro" aria-label="Alternar modo claro u oscuro">‚òÄÔ∏è Modo Claro</button>
        <button id="fuente-btn" class="btn-modo-claro" aria-label="Aumentar o reducir tama√±o de texto">üî† Ajustar texto</button>
      </div>
    </header>

    <div class="app-body" role="region" aria-label="Secci√≥n de chat colaborativo para reportes en tiempo real">
      <h1>üí¨ Chat de Zonas en Riesgo</h1>
      <div class="chat-container">
        <div id="chat-mensajes" class="chat-mensajes" aria-live="polite" aria-label="Mensajes recientes del chat">
          <!-- Mensajes cargados din√°micamente -->
        </div>
        <form id="chat-form" class="chat-formulario" aria-label="Formulario para enviar una nueva observaci√≥n">
          <input type="text" id="mensaje" name="mensaje" required placeholder="Ej: Calle 7 entre 78 y 79 con agua acumulada..." aria-label="Escriba su mensaje de observaci√≥n" />
          <button type="submit" aria-label="Enviar mensaje">Enviar</button>
        </form>
      </div>

      <a class="btn-volver" href="index.html" aria-label="Volver a la p√°gina principal">‚Üê Volver</a>
    </div>
  </div>

  <!-- Scripts para accesibilidad y chat -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const modoGuardado = localStorage.getItem('modoOscuro');
      const tama√±oFuente = localStorage.getItem('tama√±oFuente');

      const html = document.documentElement;
      const body = document.body;
      const header = document.querySelector('.app-header');
      const appBody = document.querySelector('.app-body');

      if (modoGuardado === 'true') {
        body.style.backgroundColor = '#121212';
        body.style.color = '#f5f5f5';
        if (header) header.style.backgroundColor = '#333';
        if (appBody) {
          appBody.style.backgroundColor = '#181818';
          appBody.style.color = '#f5f5f5';
        }

        const modoBtn = document.getElementById('modo-btn');
        if (modoBtn) {
          modoBtn.innerText = 'üåô Modo Oscuro';
          modoBtn.setAttribute('aria-label', 'Cambiar a modo claro');
        }
      }

      if (tama√±oFuente) {
        html.style.fontSize = tama√±oFuente;
      }
    });
  </script>

  <script src="main.js"></script>

  <script>
    const form = document.getElementById('chat-form');
    const input = document.getElementById('mensaje');
    const chat = document.getElementById('chat-mensajes');
    const STORAGE_KEY = "observacionesInundApp";

    function cargarMensajes() {
      const guardados = localStorage.getItem(STORAGE_KEY);
      if (guardados) {
        try {
          return JSON.parse(guardados);
        } catch {
          return [];
        }
      }
      return [];
    }

    function guardarMensajes(mensajes) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(mensajes));
    }

    let mensajes = cargarMensajes();

    if (mensajes.length === 0) {
      mensajes = [
        { hora: "10:15 p. m.", texto: "Calle 75 y 116 totalmente anegada, el agua llega al cord√≥n." },
        { hora: "10:18 p. m.", texto: "Hay ramas tapando la alcantarilla en 122 y 71, no drena el agua." },
        { hora: "10:21 p. m.", texto: "Se ve gente con agua entrando en sus casas en 78 e/ 8 y 9. Precauci√≥n." },
        { hora: "10:24 p. m.", texto: "Confirmo lo de 75 y 116. Dif√≠cil de circular incluso con veh√≠culos." },
        { hora: "10:26 p. m.", texto: "En la esquina de 13 y 80 hay un auto detenido por la corriente. Evitar la zona." }
      ];
      guardarMensajes(mensajes);
    }

    function renderizarMensajes() {
      chat.innerHTML = '';
      mensajes.forEach(m => {
        const msg = document.createElement('div');
        msg.classList.add('mensaje');
        msg.setAttribute('aria-label', `Mensaje recibido a las ${m.hora}`);
        msg.innerHTML = `<strong>${m.hora}</strong>: ${m.texto}`;
        chat.appendChild(msg);
      });
      chat.scrollTop = chat.scrollHeight;
    }

    renderizarMensajes();

    form.addEventListener('submit', e => {
      e.preventDefault();
      const texto = input.value.trim();
      if (!texto) return;

      const hora = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const nuevoMensaje = { hora, texto };
      mensajes.push(nuevoMensaje);
      guardarMensajes(mensajes);
      renderizarMensajes();
      input.value = '';
    });
  </script>

</body>
</html>
